{% extends "page_with_nav.html" %}
{% load staticfiles %}
{% load grades %}
{% load users %}

{% block title %}
    {{ block.super}} - Search{% if search_query %} - {{ search_query }}{% endif %}
{% endblock %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static 'css/search.css' %}">
{% endblock %}


{% block main %}
<div class="primary-content">
    <h2>Search Results</h2>
    <!--
    <form class="search" action="{% url 'search' %}" method="get" autocomplete="off">
            <input type="text" name="q" value="{{ search_query }}">
            <button type="submit">
               <i class="fa fa-search"></i>
            </button>
    </form>
    -->
    <br>
    {% if search_results %}
        <h3>Users</h3>
        {{ search_results|length }} result{{ search_results|pluralize }}
        <table class="list-table users-table">
            {% for user in search_results %}
                <tr>
                    <td class="list-item">
                        <a href="{% url 'user_profile' user.ion_id %}">
                            {% if is_admin or request.GET.last_first %}
                                {{ user.last_name }}, {{ user.first_name }}
                            {% else %}
                                {% if user.full_name %}
                                    {{ user.full_name }}
                                {% else %}
                                    {{ user.firstname }} {{ user.lastname }}
                                {% endif %}
                            {% endif %}
                            {% if user.nickname %}({{ user.nickname }}){% endif %}
                        </a>
                    </td>

                    {% if is_admin %}
                        <td>
                            {% firstof user.username|user_attr:"student_id" "" %}
                        </td>
                    {% endif %}
                    <td>
                        {% if user.grade %}
                            {% if user.grade.number == 13 %}
                                Graduate
                            {% else %}
                                Grade {{ user.grade.number }}
                            {% endif %}
                        {% else %}
                            Staff
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </table>
    {% elif search_query %}
        <h3>Users</h3>
        <b>No results.</b>
    {% endif %}
    {% if query_error %}
        <br>
        There was an error in your query syntax.
        <br>
        <br>
    {% endif %}

    {% if search_query %}
        <br /><br />
        <h3>Activities</h3>
        {% if activities %}
        {{ activities|length }} result{{ activities|pluralize }}
        <table class="list-table activities-table">
            {% for a in activities %}
                <tr>
                    <td class="list-item">
                        <a href="{% url 'eighth_activity' a.id %}">
                            {{ a.name }}
                        </a>
                        {% if a.description %}
                            <br />
                            &nbsp; &nbsp; {{ a.description|truncatechars_html:"100"|striptags }}
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </table>
        {% else %}
            <b>No results.</b>
        {% endif %}
    {% endif %}

    {% if search_query %}
        <br /><br />
        <h3>Announcements</h3>
        {% if announcements %}
        {{ announcements|length }} result{{ announcements|pluralize }}
        <table class="list-table announcements-table">
            {% for a in announcements %}
                <tr>
                    <td class="list-item">
                        <a href="{% url 'view_announcement' a.id %}">
                            {{ a.title|safe }}
                        </a><br />
                        &nbsp; &nbsp; {{ a.content|truncatechars_html:"50"|striptags }}
                    </td>
                </tr>
            {% endfor %}
        </table>
        {% else %}
            <b>No results.</b>
        {% endif %}
    {% endif %}

    {% if search_query %}
        <br /><br />
        <h3>Events</h3>
        {% if events %}
        {{ events|length }} result{{ events|pluralize }}
        <table class="list-table events-table">
            {% for a in events %}
                <tr>
                    <td class="list-item">
                        <a href="{% url 'event' a.id %}">
                            {{ a.title|safe }}
                        </a><br />
                        &nbsp; &nbsp; {{ a.description|truncatechars_html:"50"|striptags }}
                    </td>
                </tr>
            {% endfor %}
        </table>
        {% else %}
            <b>No results.</b>
        {% endif %}
    {% endif %}


    {% if "tips" in request.GET or query_error or not search_query %}
        <h3>Advanced Search Tips</h3>

        <p>
            <b>Searchable Fields</b>
            <ul>
                <li><em>name</em></li>
                <li><em>first</em></li>
                <li><em>last</em></li>
                <li><em>middle</em></li>
                <li><em>nickname</em></li>
                <li><em>id</em> (e.g. 31863)</li>
                <li><em>username</em> (e.g. 2015elowman)</li>
                <li><em>gradyear</em> (e.g. 2015)</li>
                <li><em>grade</em> (9-12)</li>
                <li><em>sex</em></li>
                <li><em>phone</em></li>
                <li><em>zip</em></li>
                <li><em>city</em></li>
                <li><em>address</em></li>
                <li><em>email</em></li>
            </ul>
        </p>
        <p>
            <b>Examples</b>
            <ul>
                <li>
                    To find all members of the class of 2016:
                    <br>
                    <em class="search-example">gradyear:2016</em>
                </li>
                <li>
                    To find all females:
                    <br>
                    <em class="search-example">sex:female</em>
                </li>
                <li>
                    To find all males in the class of 2016:
                    <br>
                    <em class="search-example">gradyear:2016 sex:male</em>
                </li>
                <li>
                    To find senior girls with first names containing "an" followed by "a":
                    <br>
                    <em class="search-example">first:an*a sex:female grade:12</em>
                </li>
                <li>
                    To find juniors who live in Falls Church <i>(use "*" in place of spaces)</i>:
                    <br>
                    <em class="search-example">city:falls*church grade:11</em>
                </li>
            </ul>
        </p>

    {% else %}
        <br><br>
        <a href="{% url 'search' %}?tips">Advanced Search Tips</a>
    {% endif %}
</div>
{% endblock %}
