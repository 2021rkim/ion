{% extends "page_with_nav.html" %}
{% load staticfiles %}
{% load dates %}

{% block title %}
    {{ block.super}} - {{ action|title }} Announcement
{% endblock %}

{% block js %}
    {{ block.super }}
    <script type="text/javascript" src="{% static 'vendor/ckeditor/ckeditor.js' %}"></script>
    <script type="text/javascript" src="{% static 'vendor/selectize.js-0.12.0/dist/js/standalone/selectize.min.js' %}"></script>
    <script type="text/javascript">
        $(function() {
            $("select#id_groups").selectize({
                plugins: ["remove_button"],
                placeholder: "Everyone"
            });

            $("select#id_teachers_requested").selectize({
                plugins: ["remove_button"]
            });
        });
    </script>
{% endblock %}

{% block css %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static 'vendor/selectize.js-0.12.0/dist/css/selectize.default.css' %}">
    <style type="text/css">

        div.cke_chrome {
            margin: 10px 0;
        }

        .announcements table {
            width: 600px;
        }

        .announcements input {
            width: 100%;
        }

        @media (max-width: 810px) {
            .announcements table, .announcements #cke_id_content {
                width: 342px !important;
            }
        }

        @media (max-width: 550px) {
            .announcements table, .announcements #cke_id_content {
                width: 400px !important;
            }
        }

        ol li {
            margin-left: 40px;
            list-style-type: circle;
        }

        #cke_id_content {
            width: 600px;
            margin-bottom: -15px;
        }

        .helptext {
            display: block;
            margin-bottom: 15px;
        }

    </style>
{% endblock %}

{% block main %}
<div class="announcements primary-content">
    <h2>
        Announcement Approval
    </h2>
    {% if admin_approve %}
        <p><a href="{% url 'user_profile' user.id %}">{{ user.full_name }} ({{ user }})</a> requested that this announcement be posted.</p>
        The following teachers were asked to approve this announcement:
        <ul>
        {% for teacher in req.teachers_requested.all %}
            <li>{{ teacher.full_name }}</li>
        {% endfor %}
        </ul>
        The following teachers approved:
        <ul>
        {% for teacher in req.teachers_approved.all %}
            <li>{{ teacher.full_name }}</li>
        {% endfor %}
        </ul>
    {% else %}
        <p>{{ user.full_name }} ({{ user }}) has requested that an Intranet announcement be posted, and has asked for you to approve its posting. The details of this announcement are included below.</p>
        <p>You may edit the fields below if you would like to change what is submitted. Please note that pressing the 'Approve' button below will not automatically post the announcement; it will still have to be approved manually by an administrator.</p>
    {% endif %}
    <form action="" method="post">
    <table>
    {% csrf_token %}
    {{ form.as_table }}
    {% if admin_approve %}
    <tr>
        <th><b>Groups:</b></th>
        <td>
            Announcement requests do not contain a groups field. <b>You must manually enter groups here if you want to restrict this posting.</b><br />
            <select name="groups" id="id_groups" multiple="multiple" placeholder="Everyone">
            {% for grp in all_groups %}
                <option value="{{ grp.id }}">{{ grp }}</option>
            {% endfor %}
            </select>
        </td>
    </tr>
    {% endif %}
    <tr>
        <td>
            &nbsp;<br />&nbsp;
        </td>
    </tr>
    <tr><td>
        <input type="submit" name="approve" value="{% if admin_approve %}Post{% else %}Approve{% endif %} Announcement" />
        </td>
        <td>
        <a href="/" class="button" onclick="alert('If you have a severe objection to the contents of this announcement, please contact the Intranet administrators at intranet@tjhsst.edu.');">Reject Announcement</a>
        </td></tr>
    </table>
    </form>
</div>
<script type="text/javascript">
    // name of <textarea> is content
    CKEDITOR.replace("content", {
        width: "600px"
    });

</script>
{% endblock %}
